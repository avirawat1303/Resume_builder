{% extends 'resumes/base.html' %}

{% block title %}Edit Resume{% endblock %}

{% block content %}
<h1><i class="fas fa-edit"></i> Edit Resume: {{ resume.full_name }}</h1>

<div class="stats-grid mb-4">
    <div class="stat-card">
        <i class="fas fa-graduation-cap"></i>
        <div class="stat-value">{{ resume.education.count }}</div>
        <div class="stat-label">Education</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-briefcase"></i>
        <div class="stat-value">{{ resume.experience.count }}</div>
        <div class="stat-label">Experience</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-tools"></i>
        <div class="stat-value">{{ resume.skills.count }}</div>
        <div class="stat-label">Skills</div>
    </div>
</div>

<!-- Basic Information -->
<div class="edit-section">
    <h2><i class="fas fa-user-circle"></i> Basic Information</h2>
    <form method="post">
        {% csrf_token %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            {% for field in form %}
                <div class="form-group" {% if field.name == 'address' or field.name == 'summary' %}style="grid-column: 1 / -1;"{% endif %}>
                    <label for="{{ field.id_for_label }}">
                        {% if field.name == 'full_name' %}
                            <i class="fas fa-user"></i>
                        {% elif field.name == 'email' %}
                            <i class="fas fa-envelope"></i>
                        {% elif field.name == 'phone' %}
                            <i class="fas fa-phone"></i>
                        {% elif field.name == 'address' %}
                            <i class="fas fa-map-marker-alt"></i>
                        {% elif field.name == 'summary' %}
                            <i class="fas fa-align-left"></i>
                        {% endif %}
                        {{ field.label }}
                    </label>
                    {{ field }}
                </div>
            {% endfor %}
        </div>
        <button type="submit" class="btn mt-2">
            <i class="fas fa-save"></i> Update Information
        </button>
    </form>
</div>

<!-- Education Section -->
<div class="edit-section">
    <h2><i class="fas fa-graduation-cap"></i> Education</h2>
    
    {% if resume.education.all %}
        <div class="item-list">
            {% for edu in resume.education.all %}
            <div class="item">
                <h3><i class="fas fa-certificate"></i> {{ edu.degree }}</h3>
                <p><i class="fas fa-university"></i> {{ edu.institution }}</p>
                <p><i class="fas fa-calendar"></i> {{ edu.start_date|date:"M Y" }} - {{ edu.end_date|date:"M Y"|default:"Present" }}</p>
                {% if edu.description %}
                    <p style="margin-top: 0.5rem;">{{ edu.description }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state" style="padding: 2rem;">
            <i class="fas fa-graduation-cap"></i>
            <p>No education entries yet</p>
        </div>
    {% endif %}
    
    <h3 class="mt-3"><i class="fas fa-plus"></i> Add Education</h3>
    <form method="post" action="{% url 'add_education' resume.id %}">
        {% csrf_token %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            {% for field in education_form %}
                <div class="form-group" {% if field.name == 'description' %}style="grid-column: 1 / -1;"{% endif %}>
                    <label for="{{ field.id_for_label }}">
                        <i class="fas fa-{% if field.name == 'degree' %}certificate{% elif field.name == 'institution' %}university{% else %}calendar{% endif %}"></i>
                        {{ field.label }}
                    </label>
                    {{ field }}
                </div>
            {% endfor %}
        </div>
        <button type="submit" class="btn btn-success mt-2">
            <i class="fas fa-plus"></i> Add Education
        </button>
    </form>
</div>

<!-- Experience Section -->
<div class="edit-section">
    <h2><i class="fas fa-briefcase"></i> Work Experience</h2>
    
    {% if resume.experience.all %}
        <div class="item-list">
            {% for exp in resume.experience.all %}
            <div class="item">
                <h3><i class="fas fa-user-tie"></i> {{ exp.job_title }}</h3>
                <p><i class="fas fa-building"></i> {{ exp.company }}</p>
                <p><i class="fas fa-calendar"></i> {{ exp.start_date|date:"M Y" }} - {{ exp.end_date|date:"M Y"|default:"Present" }}</p>
                <p style="margin-top: 0.5rem; white-space: pre-line;">{{ exp.description }}</p>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state" style="padding: 2rem;">
            <i class="fas fa-briefcase"></i>
            <p>No experience entries yet</p>
        </div>
    {% endif %}
    
    <h3 class="mt-3"><i class="fas fa-plus"></i> Add Experience</h3>
    <form method="post" action="{% url 'add_experience' resume.id %}">
        {% csrf_token %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            {% for field in experience_form %}
                <div class="form-group" {% if field.name == 'description' %}style="grid-column: 1 / -1;"{% endif %}>
                    <label for="{{ field.id_for_label }}">
                        <i class="fas fa-{% if field.name == 'job_title' %}user-tie{% elif field.name == 'company' %}building{% elif field.name == 'description' %}tasks{% else %}calendar{% endif %}"></i>
                        {{ field.label }}
                    </label>
                    {{ field }}
                </div>
            {% endfor %}
        </div>
        <button type="submit" class="btn btn-success mt-2">
            <i class="fas fa-plus"></i> Add Experience
        </button>
    </form>
</div>

<!-- Skills Section -->
<div class="edit-section">
    <h2><i class="fas fa-tools"></i> Skills</h2>
    
    {% if resume.skills.all %}
        <div class="flex flex-wrap gap-2 mb-3">
            {% for skill in resume.skills.all %}
            <div class="badge">
                <i class="fas fa-check"></i>
                {{ skill.name }} - {{ skill.proficiency }}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state" style="padding: 2rem;">
            <i class="fas fa-tools"></i>
            <p>No skills added yet</p>
        </div>
    {% endif %}
    
    <h3 class="mt-3"><i class="fas fa-plus"></i> Add Skill</h3>
    <form method="post" action="{% url 'add_skill' resume.id %}">
        {% csrf_token %}
        <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 1rem; align-items: end;">
            {% for field in skill_form %}
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="{{ field.id_for_label }}">
                        <i class="fas fa-{% if field.name == 'name' %}tag{% else %}chart-line{% endif %}"></i>
                        {{ field.label }}
                    </label>
                    {{ field }}
                </div>
            {% endfor %}
            <button type="submit" class="btn btn-success" style="margin-bottom: 0; height: 48px;">
                <i class="fas fa-plus"></i> Add
            </button>
        </div>
    </form>
</div>

<!-- Actions -->
<div class="card text-center mt-4">
    <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-check-circle"></i> Resume Ready!</h3>
    <div class="flex gap-2" style="justify-content: center;">
        <a href="{% url 'download_resume' resume.id %}" class="btn btn-success">
            <i class="fas fa-download"></i> Download PDF
        </a>
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>
{% endblock %}